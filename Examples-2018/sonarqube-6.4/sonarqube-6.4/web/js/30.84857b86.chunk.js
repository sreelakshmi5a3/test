webpackJsonp([30],{1028:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),u=o(l),p=n(4),c=n(274),f=o(c),m=n(273),d=o(m),h=n(2),g=n(448),y=function(e){function t(){var e,n,o,s;r(this,t);for(var a=arguments.length,l=Array(a),u=0;u<a;u++)l[u]=arguments[u];return n=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),o.handleToggleUser=function(e,t){var n=e.permissions.includes(t);n?o.props.revokePermissionFromUser(e.login,t):o.props.grantPermissionToUser(e.login,t)},o.handleToggleGroup=function(e,t){var n=e.permissions.includes(t);n?o.props.revokePermissionFromGroup(e.name,t):o.props.grantPermissionToGroup(e.name,t)},o.handleSelectPermission=function(e){o.props.onPermissionSelect(e)},s=n,i(o,s)}return s(t,e),a(t,[{key:"render",value:function(){var e=g.PERMISSIONS_ORDER_BY_QUALIFIER[this.props.component.qualifier];"public"===this.props.visibility&&(e=(0,p.without)(e,"user","codeviewer"));var t=e.map(function(e){return{key:e,name:(0,h.translate)("projects_role",e),description:(0,h.translate)("projects_role",e,"desc")}});return u.default.createElement(d.default,{permissions:t,selectedPermission:this.props.selectedPermission,users:this.props.users,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleUser:this.handleToggleUser,onToggleGroup:this.handleToggleGroup},u.default.createElement(f.default,{query:this.props.query,filter:this.props.filter,onSearch:this.props.onQueryChange,onFilter:this.props.onFilterChange}))}}]),t}(u.default.PureComponent);t.default=y},1029:function(e,t,n){"use strict";function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=n(1),c=r(p),f=n(15),m=r(f),d=n(4),h=n(1031),g=r(h),y=n(306),b=r(y),v=n(481),P=r(v),_=n(1028),j=r(_),C=n(1032),O=r(C),T=n(450),E=r(T),w=n(73),k=o(w),F=n(2);n(391);var S=c.default.createElement(E.default,null),U=function(e){function t(e){s(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.stopLoading=function(){n.mounted&&n.setState({loading:!1})},n.loadHolders=function(){if(n.mounted){n.setState({loading:!0});var e=n.props.component,t=n.state,o=t.filter,r=t.query,i=t.selectedPermission,s="groups"!==o?k.getPermissionsUsersForComponent(e.key,r,i,e.organization):Promise.resolve([]),a="users"!==o?k.getPermissionsGroupsForComponent(e.key,r,i,e.organization):Promise.resolve([]);Promise.all([s,a]).then(function(e){n.mounted&&n.setState({loading:!1,groups:e[1],users:e[0]})},function(e){n.mounted&&(n.props.onRequestFail(e),n.setState({loading:!1}))})}},n.handleFilterChange=function(e){n.mounted&&n.setState({filter:e},n.loadHolders)},n.handleQueryChange=function(e){n.mounted&&n.setState({query:e},function(){(0===e.length||e.length>2)&&n.loadHolders()})},n.handlePermissionSelect=function(e){n.mounted&&n.setState(function(t){return{selectedPermission:t.selectedPermission===e?void 0:e}},n.loadHolders)},n.addPermissionToGroup=function(e,t){return n.state.groups.map(function(n){return n.name===e?Object.assign({},n,{permissions:[].concat(i(n.permissions),[t])}):n})},n.addPermissionToUser=function(e,t){return n.state.users.map(function(n){return n.login===e?Object.assign({},n,{permissions:[].concat(i(n.permissions),[t])}):n})},n.removePermissionFromGroup=function(e,t){return n.state.groups.map(function(n){return n.name===e?Object.assign({},n,{permissions:(0,d.without)(n.permissions,t)}):n})},n.removePermissionFromUser=function(e,t){return n.state.users.map(function(n){return n.login===e?Object.assign({},n,{permissions:(0,d.without)(n.permissions,t)}):n})},n.grantPermissionToGroup=function(e,t){n.mounted&&(n.setState({loading:!0,groups:n.addPermissionToGroup(e,t)}),k.grantPermissionToGroup(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,groups:n.removePermissionFromGroup(e,t)}),n.props.onRequestFail(o))}))},n.grantPermissionToUser=function(e,t){n.mounted&&(n.setState({loading:!0,users:n.addPermissionToUser(e,t)}),k.grantPermissionToUser(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,users:n.removePermissionFromUser(e,t)}),n.props.onRequestFail(o))}))},n.revokePermissionFromGroup=function(e,t){n.mounted&&(n.setState({loading:!0,groups:n.removePermissionFromGroup(e,t)}),k.revokePermissionFromGroup(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,groups:n.addPermissionToGroup(e,t)}),n.props.onRequestFail(o))}))},n.revokePermissionFromUser=function(e,t){n.mounted&&(n.setState({loading:!0,users:n.removePermissionFromUser(e,t)}),k.revokePermissionFromUser(n.props.component.key,e,t,n.props.component.organization).then(n.stopLoading,function(o){n.mounted&&(n.setState({loading:!1,users:n.addPermissionToUser(e,t)}),n.props.onRequestFail(o))}))},n.handleVisibilityChange=function(e){"public"===e?n.openDisclaimer():n.turnProjectToPrivate()},n.turnProjectToPublic=function(){n.props.onComponentChange({visibility:"public"}),k.changeProjectVisibility(n.props.component.key,"public").then(function(){n.loadHolders()},function(e){n.props.onComponentChange({visibility:"private"}),n.props.onRequestFail(e)})},n.turnProjectToPrivate=function(){n.props.onComponentChange({visibility:"private"}),k.changeProjectVisibility(n.props.component.key,"private").then(function(){n.loadHolders()},function(e){n.props.onComponentChange({visibility:"public"}),n.props.onRequestFail(e)})},n.openDisclaimer=function(){n.mounted&&n.setState({disclaimer:!0})},n.closeDisclaimer=function(){n.mounted&&n.setState({disclaimer:!1})},n.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},n}return l(t,e),u(t,[{key:"componentDidMount",value:function(){this.mounted=!0,this.loadHolders()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var e=null!=this.props.component.configuration&&this.props.component.configuration.canUpdateProjectVisibilityToPrivate;return c.default.createElement("div",{className:"page page-limited",id:"project-permissions-page"},c.default.createElement(m.default,{title:(0,F.translate)("permissions.page")}),c.default.createElement(g.default,{component:this.props.component,loading:this.state.loading,loadHolders:this.loadHolders}),S,"TRK"===this.props.component.qualifier&&c.default.createElement(P.default,{canTurnToPrivate:e,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:this.props.component.visibility}),!e&&c.default.createElement(b.default,{organization:this.props.component.organization}),this.state.disclaimer&&c.default.createElement(O.default,{component:this.props.component,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic}),c.default.createElement(j.default,{component:this.props.component,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,onFilterChange:this.handleFilterChange,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,visibility:this.props.component.visibility,users:this.state.users}))}}]),t}(c.default.PureComponent);t.default=U},1030:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(1029),s=o(i),a=n(48),l=n(8),u=function(e){return{currentUser:(0,l.getCurrentUser)(e)}},p=function(e){return{onRequestFail:(0,a.onFail)(e)}};t.default=(0,r.connect)(u,p)(s.default)},1031:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),u=o(l),p=n(2),c=n(449),f=o(c),m=u.default.createElement("i",{className:"spinner"}),d=function(e){function t(){var e,n,o,s;r(this,t);for(var a=arguments.length,l=Array(a),u=0;u<a;u++)l[u]=arguments[u];return n=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),o.handleApplyTemplate=function(e){e.preventDefault(),e.target.blur();var t=o.props,n=t.component,r=t.loadHolders,i=n.organization?{key:n.organization}:null;new f.default({project:n,organization:i}).on("done",function(){return r()}).render()},s=n,i(o,s)}return s(t,e),a(t,[{key:"render",value:function(){var e=this.props.component,t=e.configuration,n=null!=t&&t.canApplyPermissionTemplate,o=["VW","SVW"].includes(e.qualifier)?(0,p.translate)("roles.page.description_portfolio"):(0,p.translate)("roles.page.description2"),r="TRK"===e.qualifier?(0,p.translate)("visibility",e.visibility,"description"):null;return u.default.createElement("header",{className:"page-header"},u.default.createElement("h1",{className:"page-title"},(0,p.translate)("permissions.page")),this.props.loading&&m,n&&u.default.createElement("div",{className:"page-actions"},u.default.createElement("button",{className:"js-apply-template",onClick:this.handleApplyTemplate},"Apply Template")),u.default.createElement("div",{className:"page-description"},u.default.createElement("p",null,o),null!=r&&u.default.createElement("p",null,r)))}}]),t}(u.default.PureComponent);t.default=d},1032:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=n(1),u=o(l),p=n(43),c=o(p),f=n(2),m=function(e){function t(){var e,n,o,s;r(this,t);for(var a=arguments.length,l=Array(a),u=0;u<a;u++)l[u]=arguments[u];return n=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),o.handleCancelClick=function(e){e.preventDefault(),o.props.onClose()},o.handleConfirmClick=function(e){e.preventDefault(),o.props.onConfirm(),o.props.onClose()},s=n,i(o,s)}return s(t,e),a(t,[{key:"render",value:function(){return u.default.createElement(c.default,{isOpen:!0,contentLabel:"modal form",className:"modal",overlayClassName:"modal-overlay",onRequestClose:this.props.onClose},u.default.createElement("header",{className:"modal-head"},u.default.createElement("h2",null,(0,f.translateWithParameters)("projects_role.turn_x_to_public",this.props.component.name))),u.default.createElement("div",{className:"modal-body"},u.default.createElement("p",null,(0,f.translate)("projects_role.are_you_sure_to_turn_project_to_public")),u.default.createElement("p",{className:"spacer-top"},(0,f.translate)("projects_role.are_you_sure_to_turn_project_to_public.2"))),u.default.createElement("footer",{className:"modal-foot"},u.default.createElement("button",{id:"confirm-turn-to-public",onClick:this.handleConfirmClick},(0,f.translate)("projects_role.turn_project_to_public")),u.default.createElement("a",{href:"#",onClick:this.handleCancelClick},(0,f.translate)("cancel"))))}}]),t}(u.default.PureComponent);t.default=m}});